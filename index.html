<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css" />
    <link rel="stylesheet" href="estilos.css" />

    <script src="node_modules/@xterm/xterm/lib/xterm.js"></script>
    <script src="node_modules/@xterm/addon-fit/lib/addon-fit.js"></script>
  </head>
  <body>
    <div id="terminal"></div>
    <script>
      var term = new Terminal({
        rows: 50,
        fontFamily: '"Cascadia Code", Menlo, monospace',
        allowProposedApi: true
      });
      const fitAddon = new FitAddon.FitAddon();
      term.loadAddon(fitAddon);

      var command = '';
      term.open(document.getElementById("terminal"));
      fitAddon.fit();
      var commands = [];

      function terminalPrompt(term) {
        command = '';
        term.write('\r\n$ ');
      }

      function runCommand(term, text) {
        const command = text.trim().split(' ')[0];
        if (command.length > 0) {
          term.writeln('');
          if (command in commands) {
            commands[command].f();
            return;
          }

          term.writeln(`${command}: comando não encontrado.`);
        }

        terminalPrompt(term);
      }
      
      term.prompt = () => {
        term.write('\r\n$ ');
      };

      term.onData(e => {
      switch (e) {
        case '\u0003': // Ctrl+C
          term.write('^C');
          terminalPrompt(term);
          break;
        case '\r': // Enter
          runCommand(term, command);
          command = '';
          break;
        case '\u007F': // Backspace (DEL)
          // Não excluir o prompt
          if (term._core.buffer.x > 2) {
            term.write('\b \b');
            if (command.length > 0) {
              command = command.substr(0, command.length - 1);
            }
          }
          break;
        default: // Caso geral: imprimir todos os caracteres.
          if (e >= String.fromCharCode(0x20) && e <= String.fromCharCode(0x7E) || e >= '\u00a0') {
            command += e;
            term.write(e);
          }
        }
      });

      term.writeln([
        '    Este é o terminal online da Design Líquido. Por ele, você pode experimentar nossas',
        '     linguagens de programação, como \x1b[3mDelégua\x1b[0m e \x1b[3mPituguês\x1b[0m!',
        '',
        ''
      ].join('\n\r'));

      term.writeln('Experimente digitar `ajuda`.');
      terminalPrompt(term);
    </script>
  </body>
</html>
